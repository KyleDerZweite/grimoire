---
// DiscordWidget.astro - Styled Discord presence/invite widget

interface Props {
  /** Discord server invite ID (e.g. "discord-invite-code") */
  inviteId?: string;
  /** Server name for placeholder display */
  serverName?: string;
}

const { inviteId = '', serverName = 'My Server' } = Astro.props;
const widgetUrl = inviteId
  ? `https://discord.com/widget?id=${inviteId}&theme=light`
  : '';
---

<div class="discord-widget">
  <div class="discord-widget__header">
    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
      <path d="M13.5 3.5C12.3 2.9 11 2.5 9.7 2.3C9.5 2.7 9.3 3.1 9.2 3.5C7.8 3.3 6.4 3.3 5 3.5C4.9 3.1 4.7 2.7 4.5 2.3C3.2 2.5 1.9 2.9 0.7 3.5C-1.2 6.8 -0.3 10 1.5 12.5C2.7 11.6 4 10.9 5.4 10.5C5.7 10.1 5.9 9.6 6.1 9.1C5.6 8.9 5.1 8.7 4.7 8.4C4.8 8.3 4.9 8.2 5 8.1C7.5 9.3 10.3 9.3 12.8 8.1C12.9 8.2 13 8.3 13.1 8.4C12.7 8.7 12.2 8.9 11.7 9.1C11.9 9.6 12.1 10.1 12.4 10.5C13.8 10.9 15.1 11.6 16.3 12.5C17.9 9.5 17.2 6.5 13.5 3.5Z" stroke="currentColor" stroke-width="0.8" fill="none" transform="translate(-0.5, 0.5) scale(0.88)"/>
    </svg>
    <span>Community</span>
  </div>

  {widgetUrl ? (
    <iframe
      src={widgetUrl}
      width="100%"
      height="300"
      frameborder="0"
      sandbox="allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts"
      loading="lazy"
      class="discord-widget__iframe"
      title="Discord server widget"
    ></iframe>
  ) : (
    <div class="discord-widget__placeholder">
      <div class="discord-widget__status">
        <span class="discord-widget__dot"></span>
        <span class="discord-widget__dot"></span>
        <span class="discord-widget__dot"></span>
      </div>
      <p class="discord-widget__server-name">{serverName}</p>
      <p class="discord-widget__hint">Discord widget goes here</p>
      <a href="#" class="discord-widget__join">Join Server</a>
    </div>
  )}
</div>

<style>
  .discord-widget {
    width: 100%;
    border-radius: var(--radius-card);
    overflow: hidden;
    background: var(--color-surface);
    border: 1.5px solid var(--color-border);
    box-shadow: var(--shadow-soft);
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
  }

  .discord-widget:hover {
    border-color: var(--color-border-hover);
    box-shadow: var(--shadow-lift);
  }

  .discord-widget__header {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 18px;
    font-family: var(--font-body);
    font-size: 0.75rem;
    font-weight: 500;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: var(--color-text-muted);
    border-bottom: 1px solid var(--color-border);
  }

  .discord-widget__iframe {
    display: block;
    border: none;
  }

  .discord-widget__placeholder {
    padding: 28px 18px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    text-align: center;
  }

  .discord-widget__status {
    display: flex;
    gap: 6px;
  }

  .discord-widget__dot {
    width: 8px;
    height: 8px;
    border-radius: 50%;
    background: var(--color-accent);
    opacity: 0.3;
    animation: dotPulse 1.8s ease-in-out infinite;
  }

  .discord-widget__dot:nth-child(2) {
    animation-delay: 0.3s;
  }

  .discord-widget__dot:nth-child(3) {
    animation-delay: 0.6s;
  }

  @keyframes dotPulse {
    0%, 100% { opacity: 0.2; transform: scale(0.85); }
    50% { opacity: 0.7; transform: scale(1.1); }
  }

  .discord-widget__server-name {
    font-family: var(--font-display);
    font-size: 1rem;
    font-weight: 500;
    color: var(--color-text);
  }

  .discord-widget__hint {
    font-size: 0.8rem;
    color: var(--color-text-muted);
    font-style: italic;
  }

  .discord-widget__join {
    display: inline-block;
    margin-top: 6px;
    padding: 8px 22px;
    font-family: var(--font-body);
    font-size: 0.8rem;
    font-weight: 500;
    color: var(--color-surface);
    background: var(--color-accent);
    border-radius: var(--radius-pill);
    text-decoration: none;
    transition: background 0.3s ease, transform 0.3s var(--ease-spring);
  }

  .discord-widget__join:hover {
    background: var(--color-accent-hover);
    transform: scale(1.04);
  }
</style>
