---
// SpotifyEmbed.astro - Styled Spotify embed placeholder

interface Props {
  /** Spotify embed URL, e.g. https://open.spotify.com/embed/track/... */
  src?: string;
  /** Compact (80px) or normal (152px) height */
  compact?: boolean;
}

const { src = '', compact = true } = Astro.props;
const height = compact ? '80' : '152';
---

<div class="spotify-widget">
  <div class="spotify-widget__header">
    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true">
      <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="1.2"/>
      <path d="M4.5 9.5C6 8.5 9.5 8 11.5 9" stroke="currentColor" stroke-width="1.2" stroke-linecap="round"/>
      <path d="M5 7.5C7 6.5 10 6 12 7" stroke="currentColor" stroke-width="1" stroke-linecap="round" opacity="0.6"/>
      <path d="M5.5 5.8C7.3 4.9 10.5 4.5 12.5 5.3" stroke="currentColor" stroke-width="0.8" stroke-linecap="round" opacity="0.3"/>
    </svg>
    <span>Now Playing</span>
  </div>

  {src ? (
    <iframe
      src={src}
      width="100%"
      height={height}
      frameborder="0"
      allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
      loading="lazy"
      class="spotify-widget__iframe"
      title="Spotify embed"
    ></iframe>
  ) : (
    <div class="spotify-widget__placeholder">
      <div class="spotify-widget__bars" aria-hidden="true">
        <span></span><span></span><span></span><span></span><span></span>
      </div>
      <p>Spotify embed goes here</p>
    </div>
  )}
</div>

<style>
  .spotify-widget {
    width: 100%;
    border-radius: var(--radius-card);
    overflow: hidden;
    background: var(--color-surface);
    border: 1.5px solid var(--color-border);
    box-shadow: var(--shadow-soft);
    transition: border-color 0.3s ease, box-shadow 0.3s ease;
  }

  .spotify-widget:hover {
    border-color: var(--color-border-hover);
    box-shadow: var(--shadow-lift);
  }

  .spotify-widget__header {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 18px;
    font-family: var(--font-body);
    font-size: 0.75rem;
    font-weight: 500;
    letter-spacing: 0.06em;
    text-transform: uppercase;
    color: var(--color-text-muted);
    border-bottom: 1px solid var(--color-border);
  }

  .spotify-widget__iframe {
    display: block;
    border: none;
    border-radius: 0;
  }

  .spotify-widget__placeholder {
    padding: 24px 18px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
  }

  .spotify-widget__placeholder p {
    font-size: 0.8rem;
    color: var(--color-text-muted);
    font-style: italic;
  }

  /* Animated equalizer bars placeholder */
  .spotify-widget__bars {
    display: flex;
    align-items: flex-end;
    gap: 3px;
    height: 24px;
  }

  .spotify-widget__bars span {
    display: block;
    width: 4px;
    background: var(--color-accent);
    border-radius: 2px;
    opacity: 0.6;
    animation: eqBounce 1.2s ease-in-out infinite alternate;
  }

  .spotify-widget__bars span:nth-child(1) { height: 8px; animation-delay: 0s; }
  .spotify-widget__bars span:nth-child(2) { height: 16px; animation-delay: 0.15s; }
  .spotify-widget__bars span:nth-child(3) { height: 24px; animation-delay: 0.3s; }
  .spotify-widget__bars span:nth-child(4) { height: 12px; animation-delay: 0.45s; }
  .spotify-widget__bars span:nth-child(5) { height: 20px; animation-delay: 0.6s; }

  @keyframes eqBounce {
    0% { transform: scaleY(0.3); }
    100% { transform: scaleY(1); }
  }
</style>
